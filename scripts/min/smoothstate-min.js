!function(t){"use strict";"object"==typeof module&&"object"==typeof module.exports?t(require("jquery"),window,document):t(jQuery,window,document)}(function($,t,e,n){"use strict";if(!t.history.pushState)return $.fn.smoothState=function(){return this},void($.fn.smoothState.options={});if(!$.fn.smoothState){var o=$("html, body"),r=t.console,a={debug:!1,anchors:"a",hrefRegex:"",forms:"form",allowFormCaching:!1,repeatDelay:500,blacklist:".no-smoothState",prefetch:!1,prefetchOn:"mouseover touchstart",prefetchBlacklist:".no-prefetch",locationHeader:"X-SmoothState-Location",cacheLength:0,loadingClass:"is-loading",scroll:!0,alterRequest:function(t){return t},alterChangeState:function(t,e,n){return t},onBefore:function(t,e){},onStart:{duration:0,render:function(t){}},onProgress:{duration:0,render:function(t){}},onReady:{duration:0,render:function(t,e){t.html(e)}},onAfter:function(t,e){}},i={isExternal:function(e){var n=e.match(/^([^:\/?#]+:)?(?:\/\/([^\/?#]*))?([^?#]+)?(\?[^#]*)?(#.*)?/);return"string"==typeof n[1]&&n[1].length>0&&n[1].toLowerCase()!==t.location.protocol||"string"==typeof n[2]&&n[2].length>0&&n[2].replace(new RegExp(":("+{"http:":80,"https:":443}[t.location.protocol]+")?$"),"")!==t.location.host},stripHash:function(t){return t.replace(/#.*/,"")},isHash:function(e,n){n=n||t.location.href;var o=e.indexOf("#")>-1,r=i.stripHash(e)===i.stripHash(n);return o&&r},translate:function(t){var e={dataType:"html",type:"GET"};return t="string"==typeof t?$.extend({},e,{url:t}):$.extend({},e,t)},shouldLoadAnchor:function(t,e,o){var r=t.prop("href");return!(i.isExternal(r)||i.isHash(r)||t.is(e)||t.prop("target")||typeof o!==n&&""!==o&&-1===t.prop("href").search(o))},clearIfOverCapacity:function(t,e){return Object.keys||(Object.keys=function(t){var e=[],n;for(n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.push(n);return e}),Object.keys(t).length>e&&(t={}),t},storePageIn:function(t,e,n,o,r,a){var i=$("<html></html>").append($(n));return void 0===r&&(r={}),void 0===a&&(a=e),t[e]={status:"loaded",title:i.find("title").first().text(),html:i.find("#"+o),doc:n,state:r,destUrl:a},t},triggerAllAnimationEndEvent:function(t,e){e=" "+e||"";var n=0,o="allanimationend",r=function(e){$(e.delegateTarget).is(t)&&(e.stopPropagation(),n++)},a=function(e){$(e.delegateTarget).is(t)&&(e.stopPropagation(),0===--n&&t.trigger(o))};t.on("animationstart webkitAnimationStart oanimationstart MSAnimationStart",r),t.on("animationend webkitAnimationEnd oanimationend MSAnimationEnd",a),t.on("allanimationend"+e,function(){n=0,i.redraw(t)})},redraw:function(t){t.height()}},s=function(e){if(null!==e.state){var n=t.location.href,o=$("#"+e.state.id),r=o.data("smoothState"),a=r.href!==n&&!i.isHash(n,r.href),s=e.state!==r.cache[r.href].state;(a||s)&&(s&&r.clear(r.href),r.load(n,!1))}},l=function(a,s){var l=$(a),c=l.prop("id"),u=null,h=!1,f={},d={},p=t.location.href,g=function(t){t=t||!1,t&&f.hasOwnProperty(t)?delete f[t]:f={},l.data("smoothState").cache=f},m=function(t,e){e=e||$.noop;var n=i.translate(t);if(f=i.clearIfOverCapacity(f,s.cacheLength),!f.hasOwnProperty(n.url)||void 0!==n.data){f[n.url]={status:"fetching"};var o=$.ajax(n);o.done(function(t){i.storePageIn(f,n.url,t,c),l.data("smoothState").cache=f}),o.fail(function(){f[n.url].status="error"}),s.locationHeader&&o.always(function(t,e,o){var r=t.statusCode?t:o,a=r.getResponseHeader(s.locationHeader);a&&(f[n.url].destUrl=a)}),e&&o.always(e)}},v=function(){if(u){var t=$(u,l);if(t.length){var e=t.offset().top;o.scrollTop(e)}u=null}},y=function(n){var a="#"+c,i=f[n]?$(f[n].html.html()):null;i.length?(e.title=f[n].title,l.data("smoothState").href=n,s.loadingClass&&o.removeClass(s.loadingClass),s.onReady.render(l,i),l.one("ss.onReadyEnd",function(){h=!1,s.onAfter(l,i),s.scroll&&v(),A(l)}),t.setTimeout(function(){l.trigger("ss.onReadyEnd")},s.onReady.duration)):!i&&s.debug&&r?r.warn("No element with an id of "+a+" in response from "+n+" in "+f):t.location=n},S=function(e,n,a){var u=i.translate(e);void 0===n&&(n=!0),void 0===a&&(a=!0);var h=!1,p=!1,v={loaded:function(){var e=h?"ss.onProgressEnd":"ss.onStartEnd";if(p&&h?p&&y(u.url):l.one(e,function(){y(u.url),a||g(u.url)}),n){var o=f[u.url].destUrl;d=s.alterChangeState({id:c},f[u.url].title,o),f[u.url].state=d,t.history.pushState(d,f[u.url].title,o)}p&&!a&&g(u.url)},fetching:function(){h||(h=!0,l.one("ss.onStartEnd",function(){s.loadingClass&&o.addClass(s.loadingClass),s.onProgress.render(l),t.setTimeout(function(){l.trigger("ss.onProgressEnd"),p=!0},s.onProgress.duration)})),t.setTimeout(function(){f.hasOwnProperty(u.url)&&v[f[u.url].status]()},10)},error:function(){s.debug&&r?r.log("There was an error loading: "+u.url):t.location=u.url}};f.hasOwnProperty(u.url)||m(u),s.onStart.render(l),t.setTimeout(function(){s.scroll&&o.scrollTop(0),l.trigger("ss.onStartEnd")},s.onStart.duration),v[f[u.url].status]()},w=function(t){var e,n=$(t.currentTarget);i.shouldLoadAnchor(n,s.blacklist,s.hrefRegex)&&!h&&(t.stopPropagation(),e=i.translate(n.prop("href")),e=s.alterRequest(e),m(e))},E=function(t){var e=$(t.currentTarget);if(!t.metaKey&&!t.ctrlKey&&i.shouldLoadAnchor(e,s.blacklist,s.hrefRegex)&&(t.stopPropagation(),t.preventDefault(),!P())){T();var n=i.translate(e.prop("href"));h=!0,u=e.prop("hash"),n=s.alterRequest(n),s.onBefore(e,l),S(n)}},b=function(t){var e=$(t.currentTarget);if(!e.is(s.blacklist)&&(t.preventDefault(),t.stopPropagation(),!P())){T();var o={url:e.prop("action"),data:e.serialize(),type:e.prop("method")};h=!0,o=s.alterRequest(o),"get"===o.type.toLowerCase()&&(o.url=o.url+"?"+o.data),s.onBefore(e,l),S(o,n,s.allowFormCaching)}},C=0,P=function(){var t=null===s.repeatDelay,e=parseInt(Date.now())>C;return!(t||e)},T=function(){C=parseInt(Date.now())+parseInt(s.repeatDelay)},A=function(t){s.anchors&&s.prefetch&&t.find(s.anchors).not(s.prefetchBlacklist).on(s.prefetchOn,null,w)},O=function(t){s.anchors&&(t.on("click",s.anchors,E),A(t)),s.forms&&t.on("submit",s.forms,b)},R=function(){var t=l.prop("class");l.removeClass(t),i.redraw(l),l.addClass(t)};return s=$.extend({},$.fn.smoothState.options,s),null===t.history.state?(d=s.alterChangeState({id:c},e.title,p),t.history.replaceState(d,e.title,p)):d={},i.storePageIn(f,p,e.documentElement.outerHTML,c,d),i.triggerAllAnimationEndEvent(l,"ss.onStartEnd ss.onProgressEnd ss.onEndEnd"),O(l),{href:p,cache:f,clear:g,load:S,fetch:m,restartCSSAnimations:R}},c=function(t){return this.each(function(){var e=this.tagName.toLowerCase();this.id&&"body"!==e&&"html"!==e&&!$.data(this,"smoothState")?$.data(this,"smoothState",new l(this,t)):!this.id&&r?r.warn("Every smoothState container needs an id but the following one does not have one:",this):"body"!==e&&"html"!==e||!r||r.warn("The smoothstate container cannot be the "+this.tagName+" tag")})};t.onpopstate=s,$.smoothStateUtility=i,$.fn.smoothState=c,$.fn.smoothState.options=a}});